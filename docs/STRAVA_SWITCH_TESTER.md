# Смена тестера Strava (лимит атлетов)

У приложения Strava по умолчанию лимит **1 подключённый атлет**. Счётчик ведётся **на стороне Strava**, не в нашей БД. Чтобы новый тестер мог подключиться, старый должен **отозвать доступ именно в Strava**.

## Порядок действий

### 1. Отвязать в нашем приложении

- Открой приложение (с любого устройства).
- Зайди в экран **Strava** (кнопка «Strava» в блоке Training).
- Нажми **Disconnect** и подтверди.

Так мы удаляем токены из нашей БД. Это не сбрасывает счётчик Strava — слот освобождается только после отзыва в Strava (шаг 2).

### 2. Отозвать доступ в Strava (обязательно делает старый тестер)

**Где отзывать:** Strava → **Настройки** → **Доступ к приложениям** (или в веб: [strava.com/settings/apps](https://www.strava.com/settings/apps)).

- Старый тестер заходит в Strava **под своим аккаунтом** (сайт или приложение).
- Открывает раздел с подключёнными приложениями.
- Находит наше приложение (название приложения из [strava.com/settings/api](https://www.strava.com/settings/api)) и нажимает **Отозвать доступ** / **Revoke** / **Удалить доступ**.

Только после этого Strava уменьшает «Number of athletes currently connected» и новый тестер сможет пройти OAuth. Если старый тестер только заходил в наше приложение и нажимал Disconnect — этого недостаточно, отзыв нужен именно в Strava.

### 3. Подключить нового тестера

- **Новый тестер** открывает наше приложение (лучше в режиме инкогнито или в чистой сессии, чтобы не было старых куки).
- В Strava должен быть залогинен **именно новый тестер** (не старый).
- В приложении нажимает **Connect Strava** и завершает авторизацию в Strava.

## Если «лимит атлетов» всё равно показывается

1. **Проверь счётчик в кабинете разработчика:** [strava.com/settings/api](https://www.strava.com/settings/api) — в карточке приложения есть «Number of athletes currently connected». Пока там 1, новый атлет получит 403.
2. **Отзыв только в Strava:** старый тестер должен отозвать доступ именно в [Настройки → Доступ к приложениям](https://www.strava.com/settings/apps), а не только нажать Disconnect у нас.
3. **Подожди 1–2 минуты** после отзыва и попробуй снова.
4. **Новый тестер** должен быть залогинен в Strava **под своим** аккаунтом (в том браузере/вкладке, где откроется OAuth Strava).

## Нужно больше одного тестера постоянно

Лимит «1 атлет» задаётся Strava для приложения. Чтобы разрешить 2 и более атлетов, нужно подать заявку в **Strava Developer Program** (форма по ссылке с [developers.strava.com](https://developers.strava.com/docs/rate-limits/) / Developer Program). После одобрения Strava увеличит квоту подключённых атлетов.

## Авто-отвязка

Если старый тестер отозвал доступ в Strava, но не заходил в наше приложение и не нажал Disconnect, мы всё равно очистим привязку при первом обращении к Strava (например при синхронизации): при ответе 401 (токен отозван) приложение удаляет сохранённые данные Strava и показывает «не подключено».
